<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birth Chart Calculation (Drik Siddhanta)</title>
</head>
<body>
    <h1>Calculate Birth Chart with Drik Siddhanta</h1>

    <div>
        <label for="birthdate">Enter Birth Date (YYYY-MM-DD):</label>
        <input type="date" id="birthdate" required />
    </div>
    <div>
        <label for="birthtime">Enter Birth Time (HH:MM):</label>
        <input type="time" id="birthtime" required />
    </div>
    <div>
        <label for="timezone">Enter Time Zone Offset (e.g., +5.5 for IST):</label>
        <input type="number" id="timezone" step="0.5" required />
    </div>

    <!-- Display current date, time, and timezone -->
    <div>
        <h3>Current UTC Date and Time</h3>
        <p id="current-date-time"></p>
        <p id="current-timezone"></p>
    </div>

    <button id="calculate-button">Calculate Birth Chart</button>
    <div id="output"></div>

    <script type="module">
        import Swisseph from '/src/swisseph.js';
        const swe = new Swisseph();
        await swe.initSwissEph();  // Ensure Swiss Ephemeris is initialized

        // Function to get current date and time in UTC, and the time zone offset
        function getCurrentDateTime() {
            const now = new Date();
            const utcDate = now.toUTCString(); // Current UTC date and time
            const timezoneOffset = now.getTimezoneOffset() / 60; // Time zone offset in hours (negative for east of UTC)
            const timezoneDisplay = `UTC${timezoneOffset >= 0 ? '+' : ''}${timezoneOffset}`;
            return { utcDate, timezoneDisplay };
        }

        // Display current UTC date, time, and time zone
        const { utcDate, timezoneDisplay } = getCurrentDateTime();
        document.getElementById('current-date-time').textContent = `Current UTC: ${utcDate}`;
        document.getElementById('current-timezone').textContent = `Your Local Time Zone: ${timezoneDisplay}`;

        // Function to get birth date and time components
        function getBirthDetails() {
            const birthdate = document.getElementById('birthdate').value;
            const birthtime = document.getElementById('birthtime').value;
            const timezoneOffset = parseFloat(document.getElementById('timezone').value);

            if (!birthdate || !birthtime || isNaN(timezoneOffset)) {
                alert("Please enter valid birth details");
                return null;
            }

            const [year, month, day] = birthdate.split('-').map(Number);
            const [hour, minute] = birthtime.split(':').map(Number);

            // Convert birth time to hours, including minutes and timezone correction
            const correctedTime = hour + minute / 60 - timezoneOffset;

            return { year, month, day, correctedTime };
        }

        document.getElementById('calculate-button').addEventListener('click', async () => {
            const birthDetails = getBirthDetails();
            if (!birthDetails) return;

            const { year, month, day, correctedTime } = birthDetails;
            
            // Calculate Julian day from the given birth details
            const jd = swe.julday(year, month, day, correctedTime);
            console.log("Julian Day:", jd);

            // Define a list of planets to calculate their positions
            const planets = [swe.SE_SUN, swe.SE_MOON, swe.SE_MERCURY, swe.SE_VENUS, swe.SE_MARS, swe.SE_JUPITER, swe.SE_SATURN];
            const planetNames = ["Sun", "Moon", "Mercury", "Venus", "Mars", "Jupiter", "Saturn"];
            let output = `<h2>Planetary Positions (Drik Siddhanta)</h2><ul>`;

            for (let i = 0; i < planets.length; i++) {
                const planet = planets[i];
                const planetName = planetNames[i];
                
                // Calculate the position for each planet
                const result = swe.calc_ut(jd, planet, swe.SEFLG_SIDEREAL); // Using sidereal flag for Drik Siddhanta
            console.log("Result:", result);
                const position = result ? result[0] : 'Error calculating position';
                
                output += `<li><strong>${planetName}:</strong> ${position}Â°</li>`;
            }

            output += `</ul>`;
            document.getElementById('output').innerHTML = output;
        });
    </script>
</body>
</html>
